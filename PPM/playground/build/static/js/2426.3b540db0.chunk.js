"use strict";(self.webpackChunk_coreui_coreui_free_react_admin_template=self.webpackChunk_coreui_coreui_free_react_admin_template||[]).push([[2426],{92426:function(e,n,t){t.r(n),t.d(n,{default:function(){return G}});var a=t(93433),l=t(74165),s=t(15861),r=t(4942),i=t(1413),c=t(29439),o=t(72791),u=t(74569),d=t.n(u),m=t(59513),h=t.n(m),v=t(36167),p=t(63521),f=t(34831),x=t(72426),g=t.n(x),j=(t(34045),t(17425)),b=t(39126),N=t(56355),Z=t(78983),S=t(83854),y=t(11683),C=t(13400),_=t(78820),M=t(49177),w=t(34911),V=t(56637),D=t(53824),R=t(48462),A=t(59170),E=t(74223),T=t(80184),I=(0,E.Z)((0,T.jsx)("path",{d:"M9 16.2 4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4L9 16.2z"}),"Done"),F=(0,E.Z)((0,T.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zM4 12c0-4.42 3.58-8 8-8 1.85 0 3.55.63 4.9 1.69L5.69 16.9C4.63 15.55 4 13.85 4 12zm8 8c-1.85 0-3.55-.63-4.9-1.69L18.31 7.1C19.37 8.45 20 10.15 20 12c0 4.42-3.58 8-8 8z"}),"Block"),k=(0,E.Z)((0,T.jsx)("path",{d:"M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"}),"Warning");function O(e){var n={fte0:(0,T.jsx)("img",{src:w,alt:"(fte_inactive_icon)",style:{height:"12px"},title:"Ex-Employee"}),fte1:(0,T.jsx)("img",{src:M,alt:"(fte_active_icon)",style:{height:"12px"},title:"Active Employee"}),fte2:(0,T.jsx)("img",{src:V,alt:"(fte_notice_icon)",style:{height:"12px"},title:"Employee in notice period"}),subk0:(0,T.jsx)("img",{src:R,alt:"(subk_inactive_icon)",style:{height:"12px"},title:"Ex-Contractor"}),subk1:(0,T.jsx)("img",{src:D,alt:"(subk_active_icon)",style:{height:"12px"},title:"Active Contractor"}),subk2:(0,T.jsx)("img",{src:A,alt:"(subk_notice_icon)",style:{height:"12px"},title:"Contractor in notice period"})},t=e.data,l=e.expandedCols,s=e.colExpandState,u=e.setRowCount,d=(0,o.useState)([]),m=(0,c.Z)(d,2),h=m[0],v=m[1],p=(0,o.useState)(null),f=(0,c.Z)(p,2),x=f[0],g=f[1],j=(0,o.useState)({}),b=(0,c.Z)(j,2),N=b[0],Z=b[1],S=(0,o.useState)(!1),E=(0,c.Z)(S,2),O=E[0],U=E[1],P=(0,o.useState)([]),B=(0,c.Z)(P,2),L=B[0],H=B[1],K=(0,o.useState)([]),q=(0,c.Z)(K,2),z=q[0],Y=q[1],G="name",W=h.filter((function(e){return null!==e[G]&&""!==e[G]})).length;u(W>0?W-1:0),(0,o.useEffect)((function(){$()}),[t]);(0,o.useEffect)((function(){O?(J++,$()):$()}),[O]);var J=0,$=function(){var a,i,o,u="",d="";1==O&&J>0?(u="expandedColumns",d="expanded"):(u="",d="");var m=t.tableData;Y(null===(a=t.columns)||void 0===a?void 0:a.replaceAll("'","").split(","));var h,p=null,f=null===m||void 0===m?void 0:m.filter((function(e){return"-2"==e.id})),x=null===m||void 0===m?void 0:m.filter((function(e){return"-1"===e.id}));(console.log(x),null!==t&&void 0!==t&&null!==(i=t.columns)&&void 0!==i&&i.includes("'"))?p=null===t||void 0===t||null===(h=t.columns)||void 0===h?void 0:h.replaceAll("'",""):p=null===t||void 0===t?void 0:t.columns;for(var j=null===(o=p)||void 0===o?void 0:o.split(","),b=[],N=[],S={},y={},M=0;M<(null===j||void 0===j?void 0:j.length);M++){var w=j[M].trim(),V=m[0];S[w]=V[w]}var D=Object.entries(S).filter((function(e){var n=(0,c.Z)(e,2),t=(n[0],n[1]);return"string"===typeof t&&t.includes("^&")}));H(D),D.map((function(e){var n=(0,c.Z)(e,2),t=n[0];n[1];l.includes(t)&&N.push((0,r.Z)({},t,!1))})),D.forEach((function(e){return y[e[1]]=e[0]}));var R=Object.entries(y);Z(Object.assign.apply(Object,[{}].concat(N)));R.map((function(e,n){var t=(0,c.Z)(e,2),a=t[0],l=t[1];b.push({accessorKey:l.lastIndexOf("_")>7?l.split("_")[0]+"_"+l.split("_")[1]+"_"+l.split("_")[2]:l.includes("total")?"total":l,header:a.split("^&")[0],enableColumnActions:!1,enableHiding:!0,Header:function(e){e.column;return(0,T.jsxs)("div",{className:l.includes("name")?"mixer":"project_ct"==l||"emp_cadre"==l||"supervisor"==l?u:"hello",children:[a.split("^&")[0]," ",l==s[2]?(0,T.jsx)("span",{className:"expandIcon ".concat(d),children:(0,T.jsx)(C.Z,{onClick:function(){U((function(e){return!e}))},children:(0,T.jsx)(_.bBv,{})})}):null]})},Cell:function(e){var n,t=e.cell,s=t.getValue(),r=isNaN(s)?"N/A":Q(s);row.empStatus;return(0,T.jsxs)("div",{className:a+"-"+l,title:t.getValue(),children:[(n=t.row.original.empStatus,"active"===n?(0,T.jsx)(I,{style:{fontSize:12}}):"inactive"===n?(0,T.jsx)(F,{style:{fontSize:12}}):"notice"===n?(0,T.jsx)(k,{style:{fontSize:12}}):null)," ","name"===t.column.id&&null!==t.row.original.parentId?(0,T.jsx)("span",{children:r}):r]})}})}));var A=f?Object.entries(f[0]):null,E=x?Object.entries(x[0]):null,P=null===A||void 0===A?void 0:A.filter((function(e){var n=(0,c.Z)(e,2),t=(n[0],n[1]);return"string"===typeof t&&t.includes("^&")}));console.log(E);var B=null===E||void 0===E?void 0:E.filter((function(e){var n=(0,c.Z)(e,2),t=n[0];return"string"===typeof n[1]&&t.includes("_")}));null===P||void 0===P||P.sort();var L=[];b.map((function(e){P.map((function(n){var t=(0,c.Z)(n,2),a=t[0],l=t[1];a.includes(e.accessorKey)&&L.push([e.accessorKey,l])}))}));var K=[],q=[];if(L.map((function(e){if(void 0==K[e[0]]){var n=[];0==n.includes(e[1])&&(n.push(e[1]),q.push(e)),K[e[0]]=n}else{var t=K[e[0]];0==t.includes(e[1])&&(t.push(e[1]),q.push(e))}})),"0"===e.formData.View)if(12===q.length)for(var z=0,G=2;z<q.length;z+=3,G+=3){var W=q[z];q[z]=q[G],q[G]=W}else if(8===q.length){if("Margin^&1^&4"===q[2][1])for(var $=0,X=1;$<q.length;X=($+=2)+1){var ne=q[$];q[$]=q[X],q[X]=ne}}b.map((function(e){var t=b.indexOf(e),a=[];null===q||void 0===q||q.map((function(l){var s=(0,c.Z)(l,2),r=s[0],i=s[1];if(r.includes(e.accessorKey)){var o={id:r+"_"+i,header:i.split("^&")[0],accessorKey:r+"_"+i,Cell:function(e){var t=e.cell;return(0,T.jsx)(T.Fragment,{children:(0,T.jsxs)("div",{className:"total"==r.split("_")[0]?"total":parseInt(r.split("_")[1])%2==0?"even":"odd",children:[(0,T.jsx)("span",{children:"name"==t.column.id?(0,T.jsxs)("span",{title:t.getValue(),children:[n[t.row.original.name]," ",t.getValue()]}):i.includes("")?(0,T.jsx)(T.Fragment,{children:(0,T.jsx)("div",{class:"align right",title:Q(t.getValue())})}):(0,T.jsxs)("div",{class:"align right",title:Q(t.getValue()),children:[Q(t.getValue())," "]})}),t.getValue()]})})}};a.push(o),b[t].columns=a}else if(!(e.accessorKey.split("_").length>2)){var u={id:e.accessorKey,header:"",accessorKey:e.accessorKey,columns:[{id:e.accessorKey,header:"",accessorKey:e.accessorKey,Cell:function(e){var n=e.cell;return(0,T.jsx)(T.Fragment,{children:(0,T.jsx)("div",{className:"total"==r.split("_")[0]?"total":parseInt(r.split("_")[1])%2==0?"even":"odd",title:n.getValue(),children:n.getValue()})})}}]};b[t].columns=[u]}}))})),b.map((function(e){var n=b.indexOf(e),t=0;e.columns.map((function(a){var l=b[n].columns.indexOf(a);b[n].columns[l].columns=[],t++,B.map((function(s){var r=(0,c.Z)(s,2),i=r[0],o=r[1];if(i.includes(e.accessorKey)){if("Margin"==a.header&&(i.includes("GM")||i.includes("marVariance"))){var u={id:i+"_"+o+"_"+t,header:o,accessorKey:i,Cell:function(e){var n=e.cell;return(0,T.jsx)(T.Fragment,{children:(0,T.jsx)("div",{className:"total"==i.split("_")[0]?"total":parseInt(i.split("_")[1])%2==0?"even":"odd",title:n.getValue(),children:n.getValue()})})}};b[n].columns[l].columns.push(u)}if("Revenue"==a.header&&(i.includes("Rev")||i.includes("revVariance"))){var d={id:i+"_"+o+"_"+t,header:o,accessorKey:i,Cell:function(e){var n=e.cell;return(0,T.jsx)(T.Fragment,{children:(0,T.jsx)("div",{className:"total"==i.split("_")[0]?"total":parseInt(i.split("_")[1])%2==0?"even":"odd",title:n.getValue(),children:n.getValue()})})}};b[n].columns[l].columns.push(d)}if("Hours"==a.header&&(i.includes("bill")||i.includes("_variance"))){var m={id:i+"_"+o+"_"+t,header:o,accessorKey:i,Cell:function(e){var n=e.cell;return(0,T.jsx)(T.Fragment,{children:(0,T.jsx)("div",{className:"total"==i.split("_")[0]?"total":parseInt(i.split("_")[1])%2==0?"even":"odd",title:n.getValue(),children:n.getValue()})})}};b[n].columns[l].columns.push(m)}}}))}))})),g(b);var te=[];null===m||void 0===m||m.map((function(e){-1!=e.id&&-3!=e.id&&-2!=e.id&&(Object.keys(e).forEach((function(n){e[n]=0==["null","undefined"].includes(""+e[n])&&isNaN(e[n])||""===e[n]||null===e[n]?e[n]:parseInt(e[n]).toLocaleString("en-US")})),null!=e.empStatus&&""!=e.empStatus?e.name=(0,T.jsxs)("div",{title:e.resource,children:[n[e.empStatus],e.resource]}):e.name=(0,T.jsx)("div",{title:e.name,children:e.name}),te.push(e))}));null===m||void 0===m||m.filter((function(e){return-2==e.id&&-3==e.id})),null===m||void 0===m||m.filter((function(e){return 999==e.id})),ee(te,{children:"subRows"});v(ee(te,{children:"subRows"}))};(0,o.useEffect)((function(){}),[z]);z&&"Array"===typeof z&&Object.keys(z).filter((function(e){return thirdHeaders.hasOwnProperty(e)})).reduce((function(e,n){return(0,i.Z)((0,i.Z)({},e),{},(0,r.Z)({},n,thirdHeaders[n]))}),[]);var Q=function(e){var n=String(e);if(1==n.includes(".")){if(1==n.includes(".00")){var t,a=n,l=(null!=(r=Number(a))&&(null===(t=r)||void 0===t?void 0:t.toFixed(0))).split(".");return l[0]=l[0].replace(/(?<=\d)(?=(\d{3})+(?!\d|\.))/g,","),l.join(".")}a=n;var s,r,i=(null!=(r=Number(a))&&(null===(s=r)||void 0===s?void 0:s.toFixed(0))).split(".");return i[0]=i[0].replace(/(?<=\d)(?=(\d{3})+(?!\d|\.))/g,","),i.join(".")}return null!=n&&(null===n||void 0===n?void 0:n.replace(/(?<=\d)(?=(\d{3})+(?!\d|\.))/g,","))};(0,o.useEffect)((function(){O?Z({}):X()}),[O]);var X=function(){var e=[];L.map((function(n){var t=(0,c.Z)(n,2),a=t[0];t[1];l.includes(a)&&e.push((0,r.Z)({},a,!1))})),Z(Object.assign.apply(Object,[{}].concat(e)))},ee=function(e,n){n=(0,i.Z)({id:"uniqueId",parentId:"parentId",children:"subRows"},n);var t={},l=[],s=n.children;return e.forEach((function(e){var a=e[n.id],l=e[n.parentId];t[a]=(0,i.Z)((0,i.Z)((0,r.Z)({},s,[]),e),t[a]),t[l]=t[l]||(0,r.Z)({},s,[]),t[l][s].push(t[a])})),Object.values(t).forEach((function(e){"undefined"===typeof e[n.id]&&l.push.apply(l,(0,a.Z)(e[s]))})),l};return(0,T.jsx)("div",{className:"materialReactExpandableTable RevenueVarianceTable darkHeader toHead",children:null!==h&&void 0!==h&&h.length?(0,T.jsx)(y.ZP,{columns:x,data:h,enableExpandAll:!0,enableExpanding:!0,enablePagination:!1,enableBottomToolbar:!1,enableTopToolbar:!1,enableColumnActions:!1,enableSorting:!1,filterFromLeafRows:!0,initialState:{expanded:!1,density:"compact",columnVisibility:(0,i.Z)({},N),columnPinning:{left:["mrt-row-expand","name","project_ct","emp_cadre","supervisor"]}},state:{columnVisibility:(0,i.Z)({},N)},muiTableContainerProps:{sx:{maxHeight:"50vh",width:"auto",maxWidth:"fit-content"}},muiTableBodyProps:{sx:{"&":{},"& td":{borderRight:"1px solid #ccc",height:"22px",fontSize:"11px",paddingTop:"0px",paddingBottom:"0px"}}},muiTableHeadProps:{sx:{"& th":{borderTop:"1px solid #ccc",borderRight:"1px solid #ccc",background:"#f4f4f4 ",fontSize:"11px",padding:"0px 8px"}}}}):""})}var U=t(85401),P=t(32125),B=t(749);var L=function(e){var n=e.setFormData,t=e.formData,a=e.measuresValidation;e.setMeasuresValidation,e.setSelectedCities,e.selectedCities,console.log(t),console.log(t.measures);var l=[{label:"Hours",code:"Hou",items:[{label:"Bill Alloc",value:"billAlloc"},{label:"Bill Actual",value:"billAct"},{label:"Variance",value:"variance"},{label:"Variance %",value:"variancePer"}]},{label:"Revenue",code:"Rev",items:[{label:"Planned",value:"plRev"},{label:"Actual",value:"actRev"},{label:"Variance",value:"revVariance"},{label:"Variance %",value:"revVariancePer"},{label:"MOM",value:"plMOM"},{label:"MOM %",value:"plMOMPerc"}]},{label:"Margin",code:"Mar",items:[{label:"Planned GM",value:"plGM"},{label:"Actual GM",value:"actGM"},{label:"Variance",value:"marVariance"},{label:"Variance %",value:"marVariancePer"}]}],s=l.flatMap((function(e){return e.items.map((function(e){return e.value}))}));(0,o.useEffect)((function(){n((function(e){return(0,i.Z)((0,i.Z)({},e),{},{measures:s})}))}),[]);var r=t.measures.length===l.length?"All  Selected":"Please Select";return(0,T.jsx)(T.Fragment,{children:(0,T.jsx)(B.N,{value:t.measures,options:l,className:" ".concat(a?"error-block":"primeMultiSelectCustomIcon"),valueRenderer:function(){},placeholder:r,onChange:function(e){console.log(null===e||void 0===e?void 0:e.value),n((function(n){return(0,i.Z)((0,i.Z)({},n),{},{measures:null===e||void 0===e?void 0:e.value})}))},maxSelectedLabels:3,optionLabel:"label",optionGroupLabel:"label",optionGroupChildren:"items",optionGroupTemplate:function(e){return(0,T.jsx)("div",{className:"flex align-items-center",children:(0,T.jsx)("div",{children:null===e||void 0===e?void 0:e.label})})},optionTemplate:function(e){return(0,T.jsxs)("div",{children:[e.label," - ",e.value]})}})})},H=t(7692),K=t(72920),q=t(22804),z=t(57689),Y=t(38262);var G=function(){var e,n,u=localStorage.getItem("resId"),m=f.N.baseUrl,x=(0,o.useState)(new Date),y=(0,c.Z)(x,2),C=y[0],_=y[1],M=(0,o.useState)(!1),w=(0,c.Z)(M,2),V=w[0],D=w[1],R=(0,o.useState)([]),A=(0,c.Z)(R,2),E=A[0],I=A[1],F=(0,o.useState)([]),k=(0,c.Z)(F,2),B=k[0],G=k[1],W=(0,o.useState)(g()(g()()).startOf("month")._d),J=(0,c.Z)(W,2),$=J[0],Q=J[1],X=(0,o.useState)([]),ee=(0,c.Z)(X,2),ne=(ee[0],ee[1]),te=(0,o.useState)(),ae=(0,c.Z)(te,2),le=ae[0],se=ae[1],re=(0,o.useState)([]),ie=(0,c.Z)(re,2),ce=(ie[0],ie[1]),oe=(0,o.useState)(0),ue=(0,c.Z)(oe,2),de=ue[0],me=ue[1],he=(0,o.useRef)(null),ve=function(e){e.expanded;return(0,T.jsx)(T.Fragment,{children:(0,T.jsx)(N.qL$,{className:"chevronIcon"})})},pe=(0,o.useState)([]),fe=(0,c.Z)(pe,2),xe=(fe[0],fe[1]),ge=(0,z.TH)(),je=new URLSearchParams(ge.search).get("id"),be=(0,o.useState)(!1),Ne=(0,c.Z)(be,2),Ze=(Ne[0],Ne[1]);(0,o.useEffect)((function(){d()({method:"get",url:m+"/dashboardsms/savedsearch/FiltersData?saved_search_id=".concat(null===je?0:je)}).then((function(e){var n=e.data;xe(n)}))}),[]);var Se={resBusinessUnit:[],resType:"-1",location:[],resBillableType:"0,1,2",loggedUser:u,contractterms:[],Customer:"-1",csl:[],Dp:[],assignedto:"-1",eng:[],View:"0",Duration:"3",FromDate:"",actualdate:g()(C).format("YYYY-MM-DD"),Summary:"bu",measures:[]},ye=(0,o.useState)(Se),Ce=(0,c.Z)(ye,2),_e=Ce[0],Me=Ce[1],we=(0,o.useState)([]),Ve=(0,c.Z)(we,2),De=Ve[0],Re=Ve[1],Ae=(0,o.useState)(!1),Ee=(0,c.Z)(Ae,2),Te=Ee[0],Ie=Ee[1],Fe=(0,o.useState)(N.UdN),ke=(0,c.Z)(Fe,2),Oe=ke[0],Ue=ke[1],Pe=(0,o.useState)([]),Be=(0,c.Z)(Pe,2),Le=Be[0],He=Be[1],Ke=(0,o.useState)([]),qe=(0,c.Z)(Ke,2),ze=qe[0],Ye=qe[1],Ge=(0,o.useState)([]),We=(0,c.Z)(Ge,2),Je=We[0],$e=We[1],Qe=(0,o.useState)([]),Xe=(0,c.Z)(Qe,2),en=(Xe[0],Xe[1]),nn=(0,o.useState)([]),tn=(0,c.Z)(nn,2),an=tn[0],ln=tn[1],sn=(0,o.useState)([]),rn=(0,c.Z)(sn,2),cn=rn[0],on=rn[1],un=(0,o.useState)([]),dn=(0,c.Z)(un,2),mn=dn[0],hn=dn[1],vn=(0,o.useState)(!1),pn=(0,c.Z)(vn,2),fn=(pn[0],pn[1]),xn=(0,o.useState)([]),gn=(0,c.Z)(xn,2),jn=gn[0],bn=gn[1],Nn=(0,o.useState)(!1),Zn=(0,c.Z)(Nn,2),Sn=Zn[0],yn=Zn[1],Cn=(0,o.useState)(!1),_n=(0,c.Z)(Cn,2),Mn=_n[0],wn=_n[1],Vn=(0,o.useState)(!1),Dn=(0,c.Z)(Vn,2),Rn=Dn[0],An=Dn[1],En=(0,o.useState)([]),Tn=(0,c.Z)(En,2),In=(Tn[0],Tn[1]),Fn=(0,o.useState)([]),kn=(0,c.Z)(Fn,2),On=kn[0],Un=(kn[1],(0,o.useState)(null)),Pn=(0,c.Z)(Un,2),Bn=Pn[0],Ln=Pn[1],Hn=(0,o.useState)([]),Kn=(0,c.Z)(Hn,2),qn=Kn[0],zn=Kn[1],Yn=(0,o.useState)([]),Gn=(0,c.Z)(Yn,2),Wn=Gn[0],Jn=Gn[1],$n=(0,o.useState)(!1),Qn=(0,c.Z)($n,2),Xn=(Qn[0],Qn[1]),et=(0,o.useState)(""),nt=(0,c.Z)(et,2),tt=nt[0],at=nt[1],lt=(0,o.useRef)([]),st=mn.columns,rt=null===st||void 0===st?void 0:st.match(/\d{4}_\d{2}_\d{2}_(billWkAlloc)/g),it=null===st||void 0===st?void 0:st.match(/\d{4}_\d{2}_\d{2}_(billWkAct)/g),ct=(0,o.useState)([]),ot=(0,c.Z)(ct,2),ut=ot[0],dt=ot[1];(0,o.useEffect)((function(){mt()}),[]);var mt=function(){d().get(m+"/CommonMS/master/getMenus?loggedUserId=".concat(u)).then((function(e){var n=e.data;ce(n),n.forEach((function(e){"Revenue Metrics"===e.display_name&&dt([e])}));var t=n.find((function(e){return"Revenue Metrics"===e.display_name})).subMenus.find((function(e){return"Revenue & Margin Variance"===e.display_name})),a=t?t.userRoles:null;se(a)}))};(0,o.useEffect)((function(){641!=le&&690!=le||(vt(),pt())}),[le]);var ht=function(){d()({method:"get",url:m+"/ProjectMS/Issues/getAssignedData"}).then((function(e){var n=e.data;ln(n)}))},vt=function(){d().get(641==le?m+"/CommonMS/master/getCSLDPAE?loggedUserId=".concat(u):m+"/SalesMS/MasterController/getCslDropDownData?userId=".concat("0")).then((function(e){var n=[],t=e.data;t.length>0&&t.forEach((function(e){var t={label:e.PersonName,value:e.id};n.push(t)})),I(n),Me((function(e){return(0,i.Z)((0,i.Z)({},e),{},(0,r.Z)({},"csl",n))}))}))},pt=function(){d().get(690==le?m+"/CommonMS/master/getDP?loggedUserId=".concat(u):m+"/CommonMS/master/getDPDropDownData?userId=".concat("0")).then((function(e){var n=[],t=e.data;t.length>0&&t.forEach((function(e){var t={label:e.PersonName,value:e.id};n.push(t)})),$e(n),en(n),Me((function(e){return(0,i.Z)((0,i.Z)({},e),{},(0,r.Z)({},"Dp",n))}))}))},ft=function(){var e=(0,s.Z)((0,l.Z)().mark((function e(){var n,t,a;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d()({url:m+"/CostMS/cost/getDepartments"});case 2:n=e.sent,(t=n.data).push({value:999,label:"Non-Revenue Units"}),He(t),Me((function(e){return(0,i.Z)((0,i.Z)({},e),{},(0,r.Z)({},"resBusinessUnit",t.filter((function(e){return 999!=e.value}))))})),a=[],t.forEach((function(e){999!=e.value&&a.push(e.value)}));case 9:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();null===_e||void 0===_e||_e.resBusinessUnit.length,(0,o.useEffect)((function(){ft(),d().get(m+"/CostMS/cost/getCountries").then((function(e){var n=[],t=e.data;t.length>0&&t.forEach((function(e){var t={label:e.country_name,value:e.id};n.push(t)})),Ye(n);var a=n.filter((function(e){return 4!==e.value}));Me((function(e){return(0,i.Z)((0,i.Z)({},e),{},(0,r.Z)({},"location",a))}))})),d().get(m+"/customersms/Customersearch/getInvoicecontractterms").then((function(e){var n=[],t=e.data;t.length>0&&t.forEach((function(e){var t={label:e.lkup_name,value:e.id};n.push(t)})),Re(n),Me((function(e){return(0,i.Z)((0,i.Z)({},e),{},(0,r.Z)({},"contractterms",n))}))})),ht(),vt(),pt(),d().get(m+"/ProjectMS/Engagement/getEngagementCompanay").then((function(e){var n=[],t=e.data;t.length>0&&t.forEach((function(e){var t={label:e.Company,value:e.id};n.push(t)})),ne(n),G(n),Me((function(e){return(0,i.Z)((0,i.Z)({},e),{},(0,r.Z)({},"eng",n))}))}))}),[]),(0,o.useEffect)((function(){d().get(m+"/revenuemetricsms/projections/geActiveCustomerList?BuIds=".concat(_e.resBusinessUnit.map((function(e){return e.value})).toString())).then((function(e){var n=[];Jn(e.data);var t=e.data;t.length>0&&t.forEach((function(e){var t={label:e.fullName,value:e.id};n.push(t)}));var a=n.map((function(e){return e.value.toString()}));zn(a)}))}),[_e.resBusinessUnit]);var xt=(0,o.useState)([{}]),gt=(0,c.Z)(xt,2),jt=gt[0],bt=gt[1],Nt=null===jt||void 0===jt?void 0:jt.map((function(e){return null===e||void 0===e?void 0:e.id})).toString();(0,o.useEffect)((function(){}),[On],[Nt],[_e.serarchVals]),(0,o.useEffect)((function(){document.getElementsByClassName("search-wrapper searchWrapper ")}),[_e.measures]),(0,o.useEffect)((function(){d().get(m+"/CommonMS/master/geActiveCustomerList").then((function(e){var n=e.data;In(n)})).catch((function(e){}))}),[On]);var Zt=null===(e=JSON.parse(localStorage.getItem("selectedCust")))||void 0===e||null===(n=e.map((function(e){return e.id})))||void 0===n?void 0:n.toString(),St=function(e,n){Promise.resolve().then(t.t.bind(t,64802,23)).then((function(t){if(t&&t.default){var a=new Blob([e],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;charset=UTF-8"});t.default.saveAs(a,n+"_export_"+(new Date).getTime()+".xlsx")}}))},yt=function(e,n){var t=e.map((function(e){return e.value})),a=n.map((function(e){return e.value}));return t.length===a.length?"<< ALL >>":e.map((function(e){return e.label})).join(", ")};return(0,T.jsxs)("div",{children:[V?(0,T.jsx)("div",{className:"statusMsg error ",children:" Please select Measures"}):"",tt,(0,T.jsx)("div",{className:"col-md-12",children:(0,T.jsxs)("div",{className:"pageTitle",children:[(0,T.jsx)("div",{className:"childOne"}),(0,T.jsx)("div",{className:"childTwo",children:(0,T.jsx)("h2",{children:"Revenue And Margin Variance"})}),(0,T.jsx)("div",{className:"childThree"})]})}),(0,T.jsx)(Y.Z,{routes:ut,currentScreenName:["Revenue And Margin Variance"]}),(0,T.jsxs)("div",{className:"group mb-3 customCard",children:[(0,T.jsxs)("div",{className:"col-md-12 collapseHeader",children:[(0,T.jsx)("h2",{children:"Search Filters"}),(0,T.jsx)("div",{className:"helpBtn",children:(0,T.jsx)(K.Z,{pdfname:"RevenueMarginVariance.pdf",name:"Revenue And Margin Variance Help"})}),(0,T.jsx)("div",{className:"saveBtn",children:(0,T.jsx)(q.Z,{setEditAddmsg:Ze,pageurl:"http://10.11.12.149:3000/#/pmo/revenueLeak",page_Name:"Plan Variance",payload:_e})})," ","\xa0",(0,T.jsx)("div",{onClick:function(){Ie(!Te),Ue(Te?N.UdN:N.NR5)},children:(0,T.jsx)("span",{children:Oe})})]}),(0,T.jsx)(Z.V9,{visible:!Te,children:(0,T.jsxs)("div",{className:"group-content row",children:[(0,T.jsx)("div",{className:" col-md-3 mb-2",children:(0,T.jsxs)("div",{className:"form-group row",children:[(0,T.jsxs)("label",{className:"col-5",htmlFor:"BU",children:["BU ",(0,T.jsx)("span",{className:"required error-text",children:"*"})]}),(0,T.jsx)("span",{className:"col-1 p-0",children:":"}),(0,T.jsx)("div",{className:"col-6 multiselect",ref:function(e){lt.current[0]=e},children:(0,T.jsx)(v.NU,{ArrowRenderer:ve,id:"resBusinessUnit",options:Le,hasSelectAll:!0,isLoading:!1,shouldToggleOnHover:!1,disableSearch:!1,value:_e.resBusinessUnit,valueRenderer:function(){var e;(e=_e.resBusinessUnit).length===Le.length||e.length===ze.length||e.length===B.length||(0===e.length||e.map((function(n){return e.length>1?n.label+",":n.label})))},disabled:!1,onChange:function(e){var n=[];e.forEach((function(e){n.push(e.value)})),Me((function(n){return(0,i.Z)((0,i.Z)({},n),{},(0,r.Z)({},"resBusinessUnit",e))}))}})})]})}),(0,T.jsx)("div",{className:" col-md-3 mb-2",children:(0,T.jsxs)("div",{className:"form-group row",children:[(0,T.jsxs)("label",{className:"col-5",htmlFor:"Country",children:["Country ",(0,T.jsx)("span",{className:"required error-text",children:"*"})]}),(0,T.jsx)("span",{className:"col-1 p-0",children:":"}),(0,T.jsx)("div",{className:"col-6 multiselect",ref:function(e){lt.current[1]=e},children:(0,T.jsx)(v.NU,{ArrowRenderer:ve,valueRenderer:yt,id:"location",options:ze,hasSelectAll:!0,value:_e.location,disabled:!1,onChange:function(e){Me((function(n){return(0,i.Z)((0,i.Z)({},n),{},(0,r.Z)({},"location",e))}))}})})]})}),(0,T.jsx)("div",{className:" col-md-3 mb-2",children:(0,T.jsxs)("div",{className:"form-group row",children:[(0,T.jsxs)("label",{className:"col-5",htmlFor:"Customer",children:["Customer",(0,T.jsx)("span",{className:"required error-text",children:"*"})]}),(0,T.jsx)("span",{className:"col-1 p-0",children:":"}),(0,T.jsx)("div",{className:"col-6",children:(0,T.jsxs)("select",{name:"Customer",id:"searchType",onChange:function(e){var n=e.target,t=(n.id,n.name),a=n.value;"Customer"==t&&"select"===a&&An(!0),In(),Me((function(e){return(0,i.Z)((0,i.Z)({},e),{},(0,r.Z)({},t,a))}))},className:"text",ref:function(e){lt.current[2]=e},children:[jt.length+"selected",(0,T.jsx)("option",{value:"-1",children:"<< ALL >>"}),(0,T.jsx)("option",{value:"0",children:"Active Customer"}),(0,T.jsx)("option",{value:"select",children:"Select"})]})})]})}),(0,T.jsx)("div",{className:" col-md-3 mb-2",children:(0,T.jsxs)("div",{className:"form-group row",children:[(0,T.jsxs)("label",{className:"col-5",htmlFor:"Res.Type",children:["Res.Type",(0,T.jsx)("span",{className:"required error-text",children:"*"})]}),(0,T.jsx)("span",{className:"col-1 p-0",children:":"}),(0,T.jsx)("div",{className:"col-6",children:(0,T.jsxs)("select",{id:"resType",className:"text",ref:function(e){lt.current[3]=e},onChange:function(e){Me((function(n){return(0,i.Z)((0,i.Z)({},n),{},(0,r.Z)({},"resType",e.target.value))}))},children:[(0,T.jsx)("option",{value:"-1",children:"<< ALL >>"}),(0,T.jsx)("option",{value:"fte",children:"Employee"}),(0,T.jsx)("option",{value:"subk",children:"Contractor"})]})})]})}),(0,T.jsx)("div",{className:" col-md-3 mb-2",children:(0,T.jsxs)("div",{className:"form-group row",children:[(0,T.jsxs)("label",{className:"col-5",htmlFor:"View",children:["View",(0,T.jsx)("span",{className:"required error-text",children:"*"})]}),(0,T.jsx)("span",{className:"col-1 p-0",children:":"}),(0,T.jsx)("div",{className:"col-6",children:(0,T.jsxs)("select",{id:"View",onChange:function(e){Me((function(n){return(0,i.Z)((0,i.Z)({},n),{},(0,r.Z)({},"View",e.target.value))}))},children:[(0,T.jsx)("option",{value:"0",children:"By Month"}),(0,T.jsx)("option",{value:"1",children:"Actual Till Date"})]})})]})}),"1"==_e.View?(0,T.jsx)("div",{className:" col-md-3 mb-2",children:(0,T.jsxs)("div",{className:"form-group row",children:[(0,T.jsx)("label",{className:"col-5",htmlFor:"Actual Till",children:"Actual Till"}),(0,T.jsx)("span",{className:"col-1 p-0",children:":"}),(0,T.jsx)("div",{className:"col-6 ActualTillRevenue",children:(0,T.jsx)(h(),{id:"actualdate",autoComplete:"off",selected:C,onChange:function(e){Me((function(n){return(0,i.Z)((0,i.Z)({},n),{},(0,r.Z)({},"actualdate",g()(e).format("yyyy-MM-DD")))})),_(e)},dateFormat:"dd-MMM-yyyy",placeholderText:"Begin Date",onKeyDown:function(e){e.preventDefault()}})})]})}):(0,T.jsx)("div",{className:" col-md-3 mb-2",children:(0,T.jsxs)("div",{className:"form-group row",children:[(0,T.jsx)("label",{className:"col-5",htmlFor:"Month",children:"Month"}),(0,T.jsx)("span",{className:"col-1 p-0",children:":"}),(0,T.jsx)("div",{className:"col-6",children:(0,T.jsx)(h(),{id:"month",selected:$,onChange:function(e){Q(e)},dateFormat:"MMM-yyyy",showMonthYearPicker:!0,onKeyDown:function(e){e.preventDefault()}})})]})}),"1"!=_e.View?(0,T.jsx)("div",{className:" col-md-3 mb-2",children:(0,T.jsxs)("div",{className:"form-group row",children:[(0,T.jsx)("label",{className:"col-5",htmlFor:"Duration",children:"Duration"}),(0,T.jsx)("span",{className:"col-1 p-0",children:":"}),(0,T.jsx)("div",{className:"col-6",children:(0,T.jsxs)("select",{id:"Duration",onChange:function(e){Me((function(n){return(0,i.Z)((0,i.Z)({},n),{},(0,r.Z)({},"Duration",e.target.value))}))},children:[(0,T.jsx)("option",{value:1,children:"1"}),(0,T.jsx)("option",{value:2,children:"2"}),(0,T.jsx)("option",{value:3,selected:!0,children:"3"}),(0,T.jsx)("option",{value:4,children:"4"}),(0,T.jsx)("option",{value:5,children:"5"}),(0,T.jsx)("option",{value:6,children:"6"}),(0,T.jsx)("option",{value:7,children:"7"}),(0,T.jsx)("option",{value:8,children:"8"}),(0,T.jsx)("option",{value:9,children:"9"}),(0,T.jsx)("option",{value:10,children:"10"}),(0,T.jsx)("option",{value:11,children:"11"}),(0,T.jsx)("option",{value:12,children:"12"})]})})]})}):"",(0,T.jsx)("div",{className:" col-md-3 mb-2",children:(0,T.jsxs)("div",{className:"form-group row",children:[(0,T.jsxs)("label",{className:"col-5",htmlFor:"Measures",children:["Measures ",(0,T.jsx)("span",{className:"required error-text",children:"*"})]}),(0,T.jsx)("span",{className:"col-1 p-0",children:":"}),(0,T.jsx)("div",{className:" col-6",children:(0,T.jsx)(L,{selectedCities:Bn,setMeasuresValidation:D,measuresValidation:V,setSelectedCities:Ln,setFormData:Me,formData:_e})})]})}),(0,T.jsx)("div",{className:" col-md-3 mb-2",children:(0,T.jsxs)("div",{className:"form-group row",children:[(0,T.jsx)("label",{className:"col-5",htmlFor:"Summary",children:"Summary"}),(0,T.jsx)("span",{className:"col-1 p-0",children:":"}),(0,T.jsx)("div",{className:"col-6",children:(0,T.jsxs)("select",{id:"Summary",onChange:function(e){Me((function(n){return(0,i.Z)((0,i.Z)({},n),{},(0,r.Z)({},"Summary",e.target.value))}))},children:[(0,T.jsx)("option",{value:"bu",children:"BU"}),(0,T.jsx)("option",{value:"customer",children:"Customer"}),(0,T.jsx)("option",{value:"resource",children:"Resource"})]})})]})}),(0,T.jsx)("div",{className:" col-md-3 mb-2",children:(0,T.jsxs)("div",{className:"form-group row",children:[(0,T.jsxs)("label",{className:"col-5",htmlFor:"Contact Terms",children:["Contract Terms ",(0,T.jsx)("span",{className:"required error-text",children:"*"})]}),(0,T.jsx)("span",{className:"col-1 p-0",children:":"}),(0,T.jsx)("div",{className:"col-6 multiselect",ref:function(e){lt.current[3]=e},children:(0,T.jsx)(v.NU,{ArrowRenderer:ve,valueRenderer:yt,id:"contractterms",options:De,hasSelectAll:!0,value:_e.contractterms,disabled:!1,onChange:function(e){Me((function(n){return(0,i.Z)((0,i.Z)({},n),{},(0,r.Z)({},"contractterms",e))}))}})})]})}),(0,T.jsx)("div",{className:" col-md-3 mb-2",children:(0,T.jsxs)("div",{className:"form-group row",children:[(0,T.jsxs)("label",{className:"col-5",htmlFor:"CSL",children:["CSL ",(0,T.jsx)("span",{className:"required error-text",children:"*"})]}),(0,T.jsx)("span",{className:"col-1 p-0",children:":"}),(0,T.jsx)("div",{className:"col-6 multiselect",ref:function(e){lt.current[4]=e},children:(0,T.jsx)(v.NU,{ArrowRenderer:ve,valueRenderer:yt,id:"csl",options:E,hasSelectAll:!0,value:_e.csl,shouldToggleOnHover:!1,disableSearch:!1,disabled:!1,onChange:function(e){Me((function(n){return(0,i.Z)((0,i.Z)({},n),{},(0,r.Z)({},"csl",e))}))}})})]})}),(0,T.jsx)("div",{className:" col-md-3 mb-2",children:(0,T.jsxs)("div",{className:"form-group row",children:[(0,T.jsxs)("label",{className:"col-5",htmlFor:"DP",children:["DP ",(0,T.jsx)("span",{className:"required error-text",children:"*"})]}),(0,T.jsx)("span",{className:"col-1 p-0",children:":"}),(0,T.jsx)("div",{className:"col-6 multiselect",ref:function(e){lt.current[5]=e},children:(0,T.jsx)(v.NU,{ArrowRenderer:ve,valueRenderer:yt,id:"Dp",options:Je,hasSelectAll:!0,value:_e.Dp,shouldToggleOnHover:!1,disableSearch:!1,disabled:!1,onChange:function(e){Me((function(n){return(0,i.Z)((0,i.Z)({},n),{},(0,r.Z)({},"Dp",e))}))}})})]})}),(0,T.jsx)("div",{className:" col-md-3 mb-2",children:(0,T.jsxs)("div",{className:"form-group row",children:[(0,T.jsx)("label",{className:"col-5",htmlFor:"Resource",children:"Resource"}),(0,T.jsx)("span",{className:"col-1 p-0",children:":"}),(0,T.jsx)("div",{className:"col-6",children:(0,T.jsx)("div",{className:"autoComplete-container",children:(0,T.jsx)(p.ReactSearchAutocomplete,{items:an,type:"text",name:"assignedto",id:"assignedto",placeholder:"Type minimum 3 characters",issueDetails:an,resourceData:ht,className:"AutoComplete",onSelect:function(e){Me((function(n){return(0,i.Z)((0,i.Z)({},n),{},{assignedto:e.id})}))},onClear:function(){Me((function(e){return(0,i.Z)((0,i.Z)({},e),{},{assignedto:-1})}))},showIcon:!1})})})]})}),(0,T.jsx)("div",{className:" col-md-3 mb-2",children:(0,T.jsxs)("div",{className:"form-group row",children:[(0,T.jsxs)("label",{className:"col-5",htmlFor:"Eng.Company",children:["Eng.Company ",(0,T.jsx)("span",{className:"required error-text",children:"*"})]}),(0,T.jsx)("span",{className:"col-1 p-0",children:":"}),(0,T.jsx)("div",{className:"col-6 multiselect",ref:function(e){lt.current[6]=e},children:(0,T.jsx)(v.NU,{ArrowRenderer:ve,valueRenderer:yt,id:"eng",options:B,hasSelectAll:!0,value:_e.eng,disabled:!1,shouldToggleOnHover:!1,onChange:function(e){Me((function(n){return(0,i.Z)((0,i.Z)({},n),{},(0,r.Z)({},"eng",e))}))}})})]})}),(0,T.jsx)("div",{className:"col-md-12 col-sm-12 col-xs-12 btn-container center my-3",children:(0,T.jsxs)("button",{type:"submit",className:"btn btn-primary",onClick:function(){hn([]);var e=(0,P.Z)(lt);if(e)at((0,T.jsxs)("div",{class:"statusMsg error",children:[(0,T.jsx)(H.I2T,{}),"Please select valid values for highlighted fields"]}));else{!e&&(V&&Ie(!Te)),at("");var n={};if(n.buIds=_e.resBusinessUnit.map((function(e){return e.value})).toString(),n.countryIds=_e.location.map((function(e){return e.value})).toString(),n.resTyp=_e.resTyp,n.month=0==_e.View?g()($).format("YYYY-MM-DD"):null,n.duration=0==_e.View?_e.Duration:null,n.atd=1==_e.View?_e.actualdate:null,n.measures=_e.measures.toString(),n.resType=_e.resType,n.customerIds="select"==_e.Customer?Zt:"0"==_e.Customer?qn.toString():_e.Customer,n.resourceId=_e.assignedto,n.summary=_e.Summary,n.cslIds=641===le?Number(u)+1:Object.keys(_e.csl).length==E.length?"-1":_e.csl.map((function(e){return e.value})).toString(),n.dpIds=690==le?Number(u)+1:Object.keys(_e.Dp).length==Je.length?"-1":_e.Dp.map((function(e){return e.value})).toString(),n.contTerms=Object.keys(_e.contractterms).length==De.length?"-1":_e.contractterms.map((function(e){return e.value})).toString(),n.engComp=Object.keys(_e.eng).length==B.length?"-1":_e.eng.map((function(e){return e.value})).toString(),n.isExport=0,n.userId=u,""==_e.measures||0==_e.measures||_e.measures==[])D(!0);else{D(!1);var t=setTimeout((function(){yn(!0)}),2e3);wn(!1),d()({method:"post",url:m+"/revenuemetricsms/projections/postRevenueMargin",data:n}).then((function(e){var n,a=e.data.tableData,l=null===(n=e.data.columns)||void 0===n?void 0:n.replaceAll("'","").split(",");on(a),function(e){console.log(null===e||void 0===e?void 0:e.length);var n={};3===(null===e||void 0===e?void 0:e.length)&&(Object.keys(e[2]).forEach((function(e,t){n[e]="0","resource"!==e&&"id"!==e&&"uniqueId"!==e&&"lvl"!==e&&"parentId"!==e||(n.resource="No Records Found",n.id="999",n.uniqueId="3",n.lvl="1",n.parentId=null)})),e[3]=n)}(a),hn(e.data),bn(l),fn(!1),setTimeout((function(){wn(!0)}),1e3),yn(!1),Xn(!0),clearTimeout(t),Ie(!Te),Ue(Te?N.UdN:N.NR5)}))}}},children:[(0,T.jsx)(N.U41,{})," Search"," "]})})]})}),Sn?(0,T.jsx)(S.Z,{setsearching:yn,handleAbort:function(){he.current&&he.current.abort(),yn(!1)}}):""]}),Mn?(0,T.jsxs)("div",{className:"col-md-12   ",children:[(0,T.jsx)("div",{className:"highlightHeading",children:(0,T.jsxs)("span",{children:["No. of"," ","bu"==_e.Summary?"BUs":"customer"==_e.Summary?"Customers":" resource"==_e.Summary?"Resources":"",": ",(0,T.jsx)("b",{children:de})]})}),(0,T.jsxs)("div",{className:"col-md-12 ",children:[(0,T.jsx)("div",{align:" right ",children:(0,T.jsx)(j.WlY,{size:"1.5em",title:"Export to Excel",style:{color:"green"},cursor:"pointer",onClick:function(){Promise.resolve().then(t.bind(t,34045)).then((function(e){var n=cn.map((function(e){var n={};return jn.forEach((function(t){var a=e[t];if("string"===typeof a){var l=a.split("^&"),s=(0,c.Z)(l,2)[0];n[t]=s}else n[t]=a})),n})),t=n.map((function(e){var n=[];return jn.forEach((function(t){n.push(e[t])})),n})),l={Sheets:{data:e.utils.aoa_to_sheet((0,a.Z)(t))},SheetNames:["data"]},s=e.write(l,{bookType:"xlsx",type:"array"});St(s,"MonthlyRevenueVariance")}))}})}),(0,T.jsx)("div",{children:(0,T.jsx)("span",{children:rt||it?(0,T.jsxs)("span",{style:{color:"#9d7c42",fontStyle:"italic"},children:[(0,T.jsx)(b.Hfo,{})," Allocs Wk Var and Actuals Wk Var: Indicates the variance from recent Saturday numbers, Month Over Month (MOM) = Month - Prev Month"]}):""})})]})]}):"",(0,T.jsx)("div",{className:"col-md-12 EngagementDetails",children:(0,T.jsx)(O,{enableRowVirtualization:!0,data:mn,expandedCols:["emp_cadre","supervisor","project_ct"],colExpandState:["0","0","name"],formData:_e,setFormData:Me,setRowCount:me})}),(0,T.jsx)(U.Z,{flag:0,variance:1,visible:Rn,setVisible:An,setSelectedItems:bt,selectedItems:jt,dataAccess:le,activeCustomersList:Wn})]})}}}]);
//# sourceMappingURL=2426.3b540db0.chunk.js.map