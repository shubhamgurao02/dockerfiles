"use strict";(self.webpackChunk_coreui_coreui_free_react_admin_template=self.webpackChunk_coreui_coreui_free_react_admin_template||[]).push([[367],{40367:function(e,n,t){t.r(n),t.d(n,{default:function(){return M}});var o=t(74165),r=t(15861),a=t(93433),i=t(4942),s=t(1413),l=t(45987),c=t(29439),u=t(72791),d=t(56355),p=t(59513),f=t.n(p),v=(t(68639),t(72426)),h=t.n(v),m=t(36167),x=t(78983),j=t(74569),b=t.n(j),g=t(34831),_=t(11683),w=t(64554),y=t(13400),k=t(78820),Z=t(15473),S=t(36151),N=t(70828),T=t(38262),R=t(17425),C=t(83854),D=t(25415),E=t.n(D),A=t(7692),F=t(72920),Y=t(80184),I=["id","projectName"],P=["text"];var M=function(){var e=new Date,n=new Date(e.getFullYear(),e.getMonth(),1),t=(0,u.useState)(!1),p=(0,c.Z)(t,2),v=p[0],j=p[1],D=(0,u.useState)(!1),M=(0,c.Z)(D,2),H=M[0],O=(M[1],(0,u.useState)()),B=(0,c.Z)(O,2),z=B[0],V=B[1],W=(0,u.useRef)(new AbortController),L=(0,u.useState)(!1),U=(0,c.Z)(L,2),K=U[0],G=U[1],J=(0,u.useState)(null),q=(0,c.Z)(J,2),Q=q[0],X=q[1],$=(0,u.useState)(n),ee=(0,c.Z)($,2),ne=ee[0],te=ee[1],oe=(0,u.useState)(null),re=(0,c.Z)(oe,2),ae=(re[0],re[1]),ie=(0,u.useState)(),se=(0,c.Z)(ie,2),le=se[0],ce=se[1],ue=(0,u.useState)(!1),de=(0,c.Z)(ue,2),pe=de[0],fe=de[1],ve=(0,u.useState)(d.UdN),he=(0,c.Z)(ve,2),me=he[0],xe=he[1],je=(0,u.useState)([]),be=(0,c.Z)(je,2),ge=be[0],_e=be[1],we=(0,u.useState)([]),ye=(0,c.Z)(we,2),ke=ye[0],Ze=ye[1],Se=(0,u.useState)([]),Ne=(0,c.Z)(Se,2),Te=Ne[0],Re=Ne[1],Ce=(0,u.useState)([]),De=(0,c.Z)(Ce,2),Ee=De[0],Ae=De[1],Fe=(0,u.useState)(""),Ye=(0,c.Z)(Fe,2),Ie=Ye[0],Pe=Ye[1],Me=(0,u.useState)(""),He=(0,c.Z)(Me,2),Oe=He[0],Be=He[1],ze=(0,u.useState)([]),Ve=(0,c.Z)(ze,2),We=Ve[0],Le=Ve[1],Ue=(0,u.useState)(null),Ke=(0,c.Z)(Ue,2),Ge=Ke[0],Je=Ke[1],qe=(0,u.useState)([]),Qe=(0,c.Z)(qe,2),Xe=(Qe[0],Qe[1]),$e=(0,u.useState)({}),en=(0,c.Z)($e,2),nn=en[0],tn=en[1],on=(0,u.useState)(null),rn=(0,c.Z)(on,2),an=rn[0],sn=rn[1],ln=(0,u.useState)(null),cn=(0,c.Z)(ln,2),un=cn[0],dn=cn[1],pn=(0,u.useState)([]),fn=(0,c.Z)(pn,2),vn=fn[0],hn=fn[1],mn=(0,u.useState)([]),xn=(0,c.Z)(mn,2),jn=xn[0],bn=xn[1],gn=(0,u.useState)(null),_n=(0,c.Z)(gn,2),wn=_n[0],yn=_n[1],kn=(0,u.useState)([]),Zn=(0,c.Z)(kn,2),Sn=Zn[0],Nn=Zn[1],Tn=(0,u.useState)(d.jS6),Rn=(0,c.Z)(Tn,2),Cn=(Rn[0],Rn[1]),Dn=(0,u.useState)(nn),En=(0,c.Z)(Dn,2),An=En[0],Fn=En[1],Yn=(0,u.useState)([]),In=(0,c.Z)(Yn,2),Pn=In[0],Mn=In[1],Hn=(0,u.useState)([]),On=(0,c.Z)(Hn,2),Bn=On[0],zn=On[1],Vn=(0,u.useState)([]),Wn=(0,c.Z)(Vn,2),Ln=Wn[0],Un=Wn[1],Kn=(0,u.useState)(),Gn=(0,c.Z)(Kn,2),Jn=Gn[0],qn=Gn[1],Qn=(0,u.useState)(!0),Xn=(0,c.Z)(Qn,2),$n=Xn[0],et=Xn[1],nt=(0,u.useState)([{label:"FM approved",value:"756"},{label:"FM rejected",value:"757"},{label:"Invoiced",value:"759",disabled:!1},{label:"Ready for finance review",value:"755",disabled:!1},{label:"Ready for Invoice",value:"758",disabled:!1}]),tt=(0,c.Z)(nt,2),ot=tt[0],rt=(tt[1],{width:"200px"}),at=(0,u.useState)([]),it=(0,c.Z)(at,2),st=it[0],lt=it[1],ct=g.N.baseUrl,ut=localStorage.getItem("resId"),dt=(0,u.useState)([]),pt=(0,c.Z)(dt,2),ft=pt[0],vt=pt[1],ht=(0,u.useState)(null),mt=(0,c.Z)(ht,2),xt=mt[0],jt=mt[1],bt=(0,u.useState)({prjSource:"PPM",prjStatus:"1",appStatus:[],period:""}),gt=(0,c.Z)(bt,2),_t=gt[0],wt=gt[1],yt=(0,u.useState)([]),kt=(0,c.Z)(yt,2),Zt=kt[0],St=kt[1];(0,u.useEffect)((function(){}),[H]),(0,u.useEffect)((function(){Tt()}),[_t,st,ne,Zt]),(0,u.useEffect)((function(){$n||function(){var e=ct+"/timeandexpensesms/tmOpen/getInvoicePeriod",n={data:{selectedvalue:Ie,projects:ke}};b().post(e,n.data).then((function(e){Be(null!==e&&void 0!==e&&e.data.invoiceCycle?null===e||void 0===e?void 0:e.data.invoiceCycle:"653")})).catch((function(e){console.error(e)}))}()}),[Ie,$n]),(0,u.useEffect)((function(){Dt()}),[Ln]),(0,u.useEffect)((function(){Fn(nn)}),[nn]),(0,u.useEffect)((function(){Et(),Rt(),Dt(),Mn([]),zn([]),Ot(),Ht()}),[Q]),(0,u.useEffect)((function(){var e={};null===an||void 0===an||an.forEach((function(n){var t={};t.id=n.project_id,t.state=n.billing_status_id,t.invOldAmt=0,e[n.project_id]=t})),jt(e)}),[an]),(0,u.useEffect)((function(){Ft()}),[]);var Nt=function(e){b()({method:"GET",url:"".concat(ct,"/timeandexpensesms/tmOpen/contractTermsType?id=").concat(e)}).then((function(e){return null===e||void 0===e?void 0:e.data})).catch((function(e){console.log("error:",e)}))},Tt=function(){var e={userId:ut,prjSource:_t.prjSource,prjStatus:_t.prjStatus,appStatus:_t.appStatus,stDate:h()(ne).format("YYYY-MM-DD")};500===Zt?b().get(ct+"/timeandexpensesms/getProjectsForAdmin").then((function(e){var n=e.data.map((function(e){var n=e.id,t=e.projectName,o=(0,l.Z)(e,I);return(0,s.Z)({label:t,value:n},o)})),t=n.map((function(e){return e.value}));Ze(t),_e(n)})):b().post(ct+"/timeandexpensesms/tmOpen/getProjectsByStatus",e).then((function(e){var n=e.data.map((function(e){var n=e.text,t=(0,l.Z)(e,P);return(0,s.Z)({label:n},t)})),t=n.map((function(e){return e.value}));Ze(t),_e(n)})).catch((function(e){console.log(e)}))},Rt=function(){var e=[];null===Q||void 0===Q||Q.tsDtls.tsInfo.forEach((function(n){var t={};n.week_no&&(t[n.week_no]=!1),n.week_no&&e.push(t)}));var n=new Set(e.map(JSON.stringify)),t=Array.from(n).map(JSON.parse);Un(t)},Ct=function(e,n,t){var o=Q.tsDates.find((function(n){return 0===n.level&&n.project_id===e.project_id})).billing_status_id,r=null===Sn||void 0===Sn?void 0:Sn.find((function(n){return n.id===e.project_id})),a=Nt(e.project_id);(r&&(null===o||"757"===o)&&!a||Ge&&"755"===o&&!a)&&("week"===t?null===e["Wk_"+n+"_state"]?j(!1):j(!0):null===e["ts_state_"+n]?j(!1):j(!0))},Dt=function(){var e=[];null===Q||void 0===Q||Q.tsDtls.tsInfo.forEach((function(n,t){var o=null;if(""!==n.week_day&&null!==n.week_day||null===n.week_no)if(null!==n.week_day&&null!==n.week_no)o={id:t+"_"+n.format_date,header:n.week_day,muiTableHeadCellProps:{sx:{textAlign:"center"}},columns:[{accessorKey:"ts_"+n.format_date,header:n.display_date,enableColumnActions:!1,enableHiding:!0,minSize:10,maxSize:10,size:10,muiTableBodyCellProps:function(e){var t=e.row;return{sx:{backgroundColor:2===t.original["ts_state_"+n.format_date]?"rgba(255, 0, 0, 0.5)":4===t.original["ts_state_"+n.format_date]?"rgba(22, 184, 44, 0.5)":"Billable Tasks"===t.original.row_type||"Non Billable Tasks"===t.original.row_type?"rgba(52, 210, 235, 0.1)":"white",borderRight:"2px solid #e0e0e0",fontSize:"13px",borderTop:"1px solid #ccc",padding:"2px 8px",verticalAlign:"middle",textAlign:"right",fontWeight:550}}},muiTableHeadCellProps:{sx:{textAlign:"center"}},Cell:function(e){var t=e.cell;return(0,Y.jsx)("div",{onClick:function(e){dn(e.currentTarget),Ct(t.row.original,n.format_date,"col"),function(e,n){yn(n);var t,o=[],r=[];if(0===n.level)null===(t=n.subRows)||void 0===t||t.forEach((function(n){var t;null===(t=n.subRows)||void 0===t||t.forEach((function(n){var t=n.subRows[0];null!==t["ts_id_"+e]&&o.push(t["ts_id_"+e]),r.push("ts_state_"+e)}))}));else if(1===n.level){var a;null===(a=n.subRows)||void 0===a||a.forEach((function(n){var t=n.subRows[0];null!==t["ts_id_"+e]&&o.push(t["ts_id_"+e]),r.push("ts_state_"+e)}))}else if(2===n.level||4===n.level){var i=n.subRows[0];null!==i["ts_id_"+e]&&o.push(i["ts_id_"+e]),r.push("ts_state_"+e)}else o.push(n["ts_id_"+e]),r.push("ts_state_"+e);hn(o),bn(r)}(n.format_date,t.row.original)},children:(0,Y.jsx)("span",{title:t.getValue().toFixed(1),children:t.getValue().toFixed(1)})})}}]},e.push(o);else{var r=zt(n.display_date);o={id:t+"_"+r,accessorKey:r,header:n.display_date,enableColumnActions:!1,enableHiding:!0,minSize:10,maxSize:200,size:"approvals"===r?200:"total_amount"===r?120:10,muiTableHeadCellProps:{sx:{textAlign:"center"}},Cell:function(e){var n,t,o,a=e.cell;return r.includes("hours")||r.includes("hrs")||"invoiced"===r||"to_invoice"===r?(0,Y.jsx)("div",{children:(0,Y.jsx)("span",{title:a.getValue()?null===(n=a.getValue())||void 0===n?void 0:n.toFixed(1):(0).toFixed(1),children:a.getValue()?null===(t=a.getValue())||void 0===t?void 0:t.toFixed(1):(0).toFixed(1)})}):r.includes("amount")||r.includes("rate")?(0,Y.jsx)("div",{children:(0,Y.jsxs)("span",{style:{display:"flex",justifyContent:"space-between"},children:[(0,Y.jsx)("span",{style:{textAlign:"left"},children:(0,Y.jsx)("span",{dangerouslySetInnerHTML:{__html:a.row.original.currency}})}),(0,Y.jsx)("span",{style:{textAlign:"right"},children:a.getValue()?null===(o=a.getValue())||void 0===o?void 0:o.toLocaleString("en-IN",{minimumFractionDigits:1,maximumFractionDigits:1}):(0).toFixed(1)})]})}):(0,Y.jsx)("div",{children:(0,Y.jsx)("span",{title:a.getValue(),children:a.getValue()})})},muiTableBodyCellProps:function(e){var n,t=e.row;return{sx:(n={backgroundColor:"rejected_hours"===r?"#faf0f0":"pending_hours"===r?"#f7f1ea":"to_invoice"===r?"#eff8eb":"Billable Tasks"===t.original.row_type||"Non Billable Tasks"===t.original.row_type?"rgba(52, 210, 235, 0.1)":"white",borderRight:"2px solid #e0e0e0",fontSize:"13px",borderTop:"1px solid #ccc"},(0,i.Z)(n,"borderRight","2px solid #e0e0e0"),(0,i.Z)(n,"padding","2px 8px"),(0,i.Z)(n,"verticalAlign","middle"),(0,i.Z)(n,"textAlign","name"===r?"left":"right"),(0,i.Z)(n,"fontWeight",550),n)}}},e.push(o)}else{var a=n.display_date.split("<br/>"),s=Ln.find((function(e){return e.hasOwnProperty(n.week_no)}));o={id:t+"_"+n.week_no,Header:function(e){e.column;return(0,Y.jsx)("div",{children:(0,Y.jsx)("span",{className:t+"_"+n.week_no,onClick:function(){At(n.week_no)},children:s&&s[n.week_no]?(0,Y.jsx)(d.ZCH,{}):(0,Y.jsx)(d.jS6,{})})})},enableColumnActions:!1,enableHiding:!0,columns:[{id:t+"_WK_"+n.week_no,accessorKey:"Wk_"+n.week_no,Header:function(e){e.column;return(0,Y.jsx)("div",{children:(0,Y.jsxs)("span",{title:"Wk_"+n.week_no,children:[a[0]," ",(0,Y.jsx)("br",{}),"to",(0,Y.jsx)("br",{}),a[2]]})})},enableColumnActions:!1,enableHiding:!0,minSize:10,maxSize:10,size:10,muiTableBodyCellProps:function(e){var t=e.row;return{sx:{backgroundColor:2===t.original["Wk_"+n.week_no+"_state"]?"rgba(255, 0, 0, 0.5)":4===t.original["Wk_"+n.week_no+"_state"]?"rgba(22, 184, 44, 0.5)":"Billable Tasks"===t.original.row_type||"Non Billable Tasks"===t.original.row_type?"rgba(52, 210, 235, 0.1)":"white",borderRight:"2px solid #e0e0e0",fontSize:"13px",borderTop:"1px solid #ccc",padding:"2px 8px",verticalAlign:"middle",textAlign:"right",fontWeight:550}}},Cell:function(e){var t=e.cell;return(0,Y.jsx)("div",{onClick:function(e){dn(e.currentTarget),Ct(t.row.original,n.week_no,"week"),function(e,n){yn(n);var t,o=[];if(0===n.level)null===(t=n.subRows)||void 0===t||t.forEach((function(n){var t;null===(t=n.subRows)||void 0===t||t.forEach((function(n){var t=n.subRows[0];Jn[e].forEach((function(e){null!==t[e]&&o.push(t[e])}))}))}));else if(1===n.level){var r;null===(r=n.subRows)||void 0===r||r.forEach((function(n){var t=n.subRows[0];Jn[e].forEach((function(e){null!==t[e]&&o.push(t[e])}))}))}else if(2===n.level){var a=n.subRows[0];Jn[e].forEach((function(e){null!==a[e]&&o.push(a[e])}))}else Jn[e].forEach((function(e){null!==n[e]&&o.push(n[e])}));var i=Jn[e].map((function(e){return e.replace("ts_id","ts_state")}));hn(o),bn(i)}(n.week_no,t.row.original)},children:(0,Y.jsx)("span",{title:t.getValue().toFixed(1),children:t.getValue().toFixed(1)})})}}]},e.push(o)}})),Le(e)},Et=function(){var e=null===Q||void 0===Q?void 0:Q.tsDtls.tsInfo.reduce((function(e,n){return null!==n.week_day&&null!==n.week_no&&null!==n.format_date&&(e[n.week_no]||(e[n.week_no]=[]),e[n.week_no].push("ts_id_"+n.format_date)),e}),{});qn(e);var n={};null===Q||void 0===Q||Q.tsDtls.tsInfo.forEach((function(e){e.week_no&&e.week_day&&(n["ts_"+e.format_date]=!1)})),tn(n);var t=null===Q||void 0===Q?void 0:Q.tsDates,o=null===t||void 0===t?void 0:t.reduce((function(e,n){var t=n.project_id;return e.projectIds.includes(t)||(e.projectIds.push(t),e.groupedRowsByProject[t]=[]),e.groupedRowsByProject[t].push(n),e}),{projectIds:[],groupedRowsByProject:{}}),r=[];null===Q||void 0===Q||Q.tsStates.forEach((function(e){var n={label:e.name,value:e.id};r.push(n)})),Xe(r);var l=[];null===o||void 0===o||o.projectIds.forEach((function(e){var n=null===o||void 0===o?void 0:o.groupedRowsByProject[e],t=n[0];t.subRows=[];var r=t.billing_status_id,c=null===Sn||void 0===Sn?void 0:Sn.find((function(e){return e.id===t.project_id})),u=function(){return!((!c||null!==r&&"757"!==r||Nt(t.project_id))&&(!Ge||null===r||Nt(t.project_id)))};t.prjInvoiceAmount=(0,Y.jsx)("input",{type:"checkbox",className:"prjInvoiceAmount",disabled:100!==Zt&&500!==Zt&&!u(),onChange:function(e){!function(e,n){var t=e.target.checked;jt((function(e){return(0,s.Z)((0,s.Z)({},e),{},(0,i.Z)({},n.project_id,(0,s.Z)((0,s.Z)({},e[n.project_id]),{},{invOldAmt:t?1:0})))}))}(e,t)}});var d=null===Q||void 0===Q?void 0:Q.tsStates.map((function(e){return 758===e.id?(0,s.Z)((0,s.Z)({},e),{},{name:"Ready for Invoice"}):e})),p=function(e){var n=e.target.value;jt((function(e){return(0,s.Z)((0,s.Z)({},e),{},(0,i.Z)({},t.project_id,(0,s.Z)((0,s.Z)({},e[t.project_id]),{},{state:n})))}))};if(c)if(null===r){var f=d.find((function(e){return 755===e.id}));t.approvals=(0,Y.jsx)("div",{children:(0,Y.jsxs)("select",{defaultValue:r,className:"approvals",id:"approvals",disabled:100!==Zt&&500!==Zt&&!u(),onChange:p,style:rt,children:[(0,Y.jsx)("option",{value:"0",selected:!0,children:"<<Please Select>>"},"0"),(0,Y.jsx)("option",{value:f.id,children:f.name},f.id)]})})}else t.approvals="757"===r?(0,Y.jsx)("div",{children:(0,Y.jsx)("select",{defaultValue:r,className:"approvals",id:"approvals",disabled:100!==Zt&&500!==Zt&&!u(),onChange:p,style:rt,children:d.map((function(e){return(0,Y.jsx)("option",{value:e.id,disabled:755!==e.id,hidden:756==e.id||758==e.id||759==e.id,children:e.name},e.id)}))})}):(0,Y.jsx)("div",{children:(0,Y.jsx)("select",{defaultValue:r,className:"approvals",id:"approvals",disabled:100!==Zt&&500!==Zt&&!u(),onChange:p,style:rt,children:d.map((function(e){return(0,Y.jsx)("option",{value:e.id,children:e.name},e.id)}))})});else Ge?u()?t.approvals=(0,Y.jsx)("div",{children:(0,Y.jsx)("select",{defaultValue:r,className:"approvals",id:"approvals",disabled:100!==Zt&&500!==Zt&&!u(),onChange:p,style:rt,children:d.map((function(e){return(0,Y.jsx)("option",{value:e.id,disabled:755===e.id,hidden:759===e.id,children:e.name},e.id)}))})}):t.approvals=(0,Y.jsx)("div",{children:(0,Y.jsx)("select",{defaultValue:r,className:"approvals",id:"approvals",disabled:100!==Zt&&500!==Zt&&!u(),onChange:p,style:rt,children:(0,Y.jsx)("option",{value:"0",children:"<<Please Select>>"},"0")})}):t.approvals=(0,Y.jsx)("div",{children:(0,Y.jsx)("select",{defaultValue:r,className:"approvals",id:"approvals",disabled:!u(),onChange:p,style:rt,children:(0,Y.jsx)("option",{value:"0",children:"<<Please Select>>"},"0")})});var v=n.filter((function(e){return"Resource"==e.row_type})),h=n.filter((function(e){return"Billable Tasks"==e.row_type})),m=n.filter((function(e){return"Non Billable Tasks"==e.row_type})),x=n.filter((function(e){return"Billable"==e.row_type})),j=n.filter((function(e){var n;return null===(n=e.type)||void 0===n?void 0:n.includes("Non Billable")}));null===v||void 0===v||v.forEach((function(e){var t,o=h.filter((function(n){return n.resource_id==e.resource_id})),r=null===(t=m.filter((function(n){return n.resource_id==e.resource_id})))||void 0===t?void 0:t.slice(0,1),i=x.filter((function(n){return n.resource_id==e.resource_id})),s=j.filter((function(n){return n.resource_id==e.resource_id}));o&&o[0]&&i&&(o[0].subRows=i),r&&r[0]&&s&&(r[0].subRows=s),e.subRows=[].concat((0,a.Z)(o),(0,a.Z)(r)),n[0].subRows.push(e)})),console.log(n),l.push(n[0])})),sn(l)},At=function(e){var n=[],t=[];null===Q||void 0===Q||Q.tsDtls.tsInfo.forEach((function(n){if(n.week_no===e&&n.week_day){var o={};o[n.week_no]="ts_"+n.format_date,t.push(o)}})),t.forEach((function(t){t[e]&&n.push(t[e])})),Fn((function(e){var t=(0,s.Z)({},e);return n.forEach((function(e){t.hasOwnProperty(e)&&(t[e]=!t[e])})),t})),Cn((function(e){return e===d.jS6?d.ZCH:d.jS6})),Un((function(n){return n.map((function(n){return n.hasOwnProperty(e)?(0,i.Z)({},e,!n[e]):n}))}))},Ft=function(){b()({method:"GET",url:ct+"/CommonMS/master/getMenus?loggedUserId=".concat(ut)}).then((function(e){var n=e.data;n.forEach((function(e){"Time & Expenses"===e.display_name&&vt([e])}));var t=n.find((function(e){return"Time & Expenses"===e.display_name})).subMenus.find((function(e){return"T&M - Open"===e.display_name})),o=t?t.access_level:null;St(o)}))},Yt=function(){var e=(0,r.Z)((0,o.Z)().mark((function e(){var n,t;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=ct+"/timeandexpensesms/tmOpen/savePtjTsReportRuns",t={filterName:Oe.toString(),UserId:ut,projects:Ee},e.next=4,b().post(n,t,{signal:W.current.signal}).then((function(e){var n=null===e||void 0===e?void 0:e.data.reportRunId;ce(n);var t=h()(ne).format("YYYY-MM-DD"),o=h()(ne).endOf("month").format("YYYY-MM-DD");It(n,t,o)})).catch((function(e){console.error(e)}));case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),It=function(){var e=(0,r.Z)((0,o.Z)().mark((function e(n,t,r){var a,i;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return W.current.abort(),W.current=new AbortController,G(!1),a=ct+"/timeandexpensesms/tmOpen/getPrjTeamTimeSheet",i={month:t,reportRunId:n,endDate:r},e.next=7,b().post(a,i,{signal:W.current.signal}).then((function(e){X(e.data)})).catch((function(e){console.log(e)}));case 7:G(!1),fe(!pe),xe(pe?d.UdN:d.NR5);case 10:case"end":return e.stop()}}),e)})));return function(n,t,o){return e.apply(this,arguments)}}(),Pt=function(){var e=(0,r.Z)((0,o.Z)().mark((function e(){var n,t,r,a;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=ct+"/timeandexpensesms/tmOpen/saveTeamTs",t={startDate:Q.tsDtls.startDate,endDate:Q.tsDtls.endDate,Approved:Pn,Rejected:Bn,prjStates:xt},e.next=4,b().post(n,t).then((function(e){V("Timesheet saved successfully!!"),setTimeout((function(){V()}),3e3)})).catch((function(e){console.log(e)}));case 4:r=h()(null===Q||void 0===Q?void 0:Q.tsDtls.startDate).format("YYYY-MM-DD"),a=h()(null===Q||void 0===Q?void 0:Q.tsDtls.startDate).endOf("month").format("YYYY-MM-DD"),It(le,r,a);case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Mt=function(e,n,t){e.forEach((function(e){e.project_id===n.project_id&&(0===n.level?(jn.forEach((function(n){e[n]&&(e[n]=t)})),e.subRows.forEach((function(e){var n;jn.forEach((function(n){e[n]&&(e[n]=t)})),null===(n=e.subRows)||void 0===n||n.forEach((function(e){jn.forEach((function(n){e[n]&&(e[n]=t)}));var n=e.subRows[0];jn.forEach((function(e){n[e]&&(n[e]=t)}))}))}))):e.subRows.forEach((function(e){var o;e.resource_id===n.resource_id&&(jn.forEach((function(n){e[n]&&(e[n]=t)})),null===(o=e.subRows)||void 0===o||o.forEach((function(e){jn.forEach((function(n){e[n]&&(e[n]=t)}));var n=e.subRows[0];jn.forEach((function(e){n[e]&&(n[e]=t)}))})))})))}))},Ht=function(){var e=(0,r.Z)((0,o.Z)().mark((function e(){return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,b().get(ct+"/timeandexpensesms/tmOpen/fmUserRole",{params:{userId:ut,source:_t.prjSource}}).then((function(e){Je(e.data)})).catch((function(e){console.log(e)}));case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Ot=function(){b().get(ct+"/timeandexpensesms/tmOpen/userRole",{params:{userId:ut,source:_t.prjSource}}).then((function(e){Nn(e.data)})).catch((function(e){console.error(e)}))},Bt=function(){var e,n,t=Q.tsDates.filter((function(e){return"Resource"==e.row_type})),o=["Resource Name","Project Name","Role Name","Task Name","Task Type","Rate","Logged Hours","Rejected Hours","Pending Hours","To Invoice","Invoiced","Invoice Amount","Yet To Invoice Hours","Yet To Invoice Amount"];null===Q||void 0===Q||null===(e=Q.tsDtls)||void 0===e||null===(n=e.tsInfo)||void 0===n||n.forEach((function(e){e.format_date&&o.push(e.format_date)}));var r=[];t.forEach((function(e){var n=[];o.forEach((function(t){if(t.includes("_"))e["ts_"+t]?n.push(e["ts_"+t].toFixed(1)):n.push((0).toFixed(1));else{var o=function(e,n){var t=Q.tsDates.find((function(e){return e.resource_id===n.resource_id&&(3===e.level||4===e.level)})),o=Q.tsDates.find((function(e){return e.project_id===n.project_id&&0===e.level})),r="",a="";switch(e){case"Task Name":r=null===t||void 0===t?void 0:t.name;break;case"Project Name":r=null===o||void 0===o?void 0:o.name;break;case"Resource Name":r=null===n||void 0===n?void 0:n.name;break;case"Task Type":r=null===t||void 0===t?void 0:t.row_type;break;case"Role Name":r=null===n||void 0===n?void 0:n.type;break;case"Rate":a=null===n.rate?n.currency+" "+(0).toFixed(2):n.currency+" "+n.rate.toFixed(2),r=(new DOMParser).parseFromString(a,"text/html").body.textContent;break;case"Logged Hours":r=null!==n.logged_hours?n.logged_hours.toFixed(1):(0).toFixed(1);break;case"Rejected Hours":r=null!==n.rejected_hours?n.rejected_hours.toFixed(1):(0).toFixed(1);break;case"Pending Hours":r=null!==n.pending_hours?n.pending_hours.toFixed(1):(0).toFixed(1);break;case"Invoiced":r=null!==n.invoiced?n.invoiced.toFixed(1):(0).toFixed(1);break;case"To Invoice":r=null!==n.to_invoice?n.to_invoice.toFixed(1):(0).toFixed(1);break;case"Invoice Amount":a=null===n.invoice_amount?n.currency+" "+(0).toFixed(2):n.currency+" "+n.invoice_amount.toFixed(2),r=(new DOMParser).parseFromString(a,"text/html").body.textContent;break;case"Yet To Invoice Hours":r=null!==n.yet_to_invoice_hrs?n.yet_to_invoice_hrs.toFixed(1):(0).toFixed(1);break;case"Yet To Invoice Amount":a=null===n.yet_to_invoice_amount?n.currency+" "+(0).toFixed(2):n.currency+" "+n.yet_to_invoice_amount.toFixed(2),r=(new DOMParser).parseFromString(a,"text/html").body.textContent}return r}(t,e);o?n.push(""+o):t.includes("Amount")||"Rate"===t||"To Invoice"===t?n.push((0).toFixed(1)):n.push(""+o)}})),r.push(n)}));var a=new(E().Workbook),i=a.addWorksheet("Timesheet"),s=o.map((function(e){return e.includes("_")?e.replace(/_/g,"-"):e}));i.addRow(s),r.forEach((function(e){i.addRow(e)})),i.getRow(1).font={bold:!0},a.xlsx.writeBuffer().then((function(e){saveAs(new Blob([e]),"Timesheet.xlsx")}))},zt=function(e){var n="";switch(e){case"Project":n="name";break;case"Task Type/Role":n="type";break;case"Billing Rate":n="rate";break;case"Logged Hrs":n="logged_hours";break;case"Rejected Hrs":n="rejected_hours";break;case"Pending Approval Hrs":n="pending_hours";break;case"Already Invoiced Hrs":n="invoiced";break;case"To be Invoiced Hrs":n="to_invoice";break;case"Invoiceable Amount":n="invoice_amount";break;case"Approvals":n="approvals";break;case"Total Invoice Hrs":n="yet_to_invoice_hrs";break;case"Yet to be Invoiced":n="yet_to_invoice_amount";break;case"Total Amount":n="total_amount";break;case"Invoice Amount":n="prjInvoiceAmount"}return n},Vt=function(e){e.expanded;return(0,Y.jsx)(Y.Fragment,{children:(0,Y.jsx)(d.qL$,{className:"chevronIcon"})})},Wt=function(e,n){var t=e.map((function(e){return e.value})),o=n.map((function(e){return e.value}));return 0!=t.length&&t.length===o.length?"<< ALL >>":e.map((function(e){return e.label})).join(", ")};return(0,Y.jsxs)("div",{children:[z&&z.includes("projects")?(0,Y.jsx)("div",{className:"statusMsg error",children:(0,Y.jsxs)("span",{children:[(0,Y.jsx)(A.Cw1,{className:"error-icon"}),z]})}):z?(0,Y.jsx)("div",{className:"statusMsg success",children:(0,Y.jsxs)("span",{children:[(0,Y.jsx)(A.hXj,{}),z]})}):null,(0,Y.jsx)("div",{className:"col-md-12",children:(0,Y.jsxs)("div",{className:"pageTitle",children:[(0,Y.jsx)("div",{className:"childOne"}),(0,Y.jsx)("div",{className:"childTwo",children:(0,Y.jsx)("h2",{children:"Project Timesheet"})}),(0,Y.jsx)("div",{className:"childThree"})]})}),(0,Y.jsx)(T.Z,{routes:ft,currentScreenName:["T&M - Open"]})," ",(0,Y.jsxs)("div",{className:"group mb-3 customCard",children:[(0,Y.jsxs)("div",{className:"col-md-12 collapseHeader",children:[(0,Y.jsx)("h2",{children:"Search Filters"}),(0,Y.jsx)("div",{className:"helpBtn",children:(0,Y.jsx)(F.Z,{pdfname:"TMOpen.pdf",name:"Project Timesheet Help"})}),(0,Y.jsx)("div",{onClick:function(){fe(!pe),xe(pe?d.UdN:d.NR5)},children:(0,Y.jsx)("span",{children:me})})]}),(0,Y.jsx)(x.V9,{visible:!pe,children:(0,Y.jsxs)("div",{className:"group-content row",children:[(0,Y.jsx)("div",{className:"col-md-4 mb-2",children:(0,Y.jsxs)("div",{className:"form-group row",children:[(0,Y.jsxs)("label",{className:"col-5",htmlFor:"email-input",children:["Source",(0,Y.jsx)("span",{style:{color:"red"},children:"*"})]}),(0,Y.jsx)("span",{className:"col-1",children:":"}),(0,Y.jsx)("div",{className:"col-6",children:(0,Y.jsxs)("select",{id:"project-select",onChange:function(e){var n=e.target.value;Re([]),Ae([]),Pe(""),et(!0),wt((function(e){return(0,s.Z)((0,s.Z)({},e),{},{prjSource:n})}))},style:rt,children:[(0,Y.jsx)("option",{value:"PPM",children:"PPM"}),(0,Y.jsx)("option",{value:"Projector",children:"Projector"})]})})]})}),(0,Y.jsx)("div",{className:"col-md-4 mb-2",children:(0,Y.jsxs)("div",{className:"form-group row",children:[(0,Y.jsxs)("label",{className:"col-5",htmlFor:"email-input",children:["Status",(0,Y.jsx)("span",{style:{color:"red"},children:"*"})]}),(0,Y.jsx)("span",{className:"col-1",children:":"}),(0,Y.jsx)("div",{className:"col-6",children:(0,Y.jsxs)("select",{id:"status-select",onChange:function(e){var n=e.target.value;Re([]),Ae([]),Pe(""),et(!0),wt((function(e){return(0,s.Z)((0,s.Z)({},e),{},{prjStatus:n})}))},style:rt,children:[(0,Y.jsx)("option",{value:"",children:"All"}),(0,Y.jsx)("option",{value:"1",selected:!0,children:"In progress"}),(0,Y.jsx)("option",{value:"2",children:"Completed"}),(0,Y.jsx)("option",{value:"3",children:"On hold"})]})})]})}),(0,Y.jsx)("div",{className:"col-md-4 mb-2",children:(0,Y.jsxs)("div",{className:"form-group row",children:[(0,Y.jsx)("label",{className:"col-5",htmlFor:"country-select",children:"Approval Status"}),(0,Y.jsx)("span",{className:"col-1",children:":"}),(0,Y.jsx)("div",{className:"col-6",children:(0,Y.jsx)(m.NU,{ArrowRenderer:Vt,id:"appStatus",options:ot,value:st,valueRenderer:Wt,hasSelectAll:!0,isLoading:!1,shouldToggleOnHover:!1,disableSearch:!1,disabled:!1,onChange:function(e){Re([]),Ae([]),Pe(""),et(!0),lt(e);var n=e.map((function(e){return e.value}));wt((function(e){return(0,s.Z)((0,s.Z)({},e),{},{appStatus:n})}))}})})]})}),(0,Y.jsx)("div",{className:"col-md-4 mb-2",children:(0,Y.jsxs)("div",{className:"form-group row",children:[(0,Y.jsx)("label",{className:"col-5",htmlFor:"email-input",children:"Month"}),(0,Y.jsx)("span",{className:"col-1",children:":"}),(0,Y.jsx)("div",{className:"col-6 z-4",children:(0,Y.jsx)(f(),{selected:ne,onChange:function(e){te(e),Re([]),Ae([]),Pe(""),et(!0);var n=h()(e).endOf("month").format("YYYY-MM-DD");ae(n)},dateFormat:"MMM yyyy",showMonthYearPicker:!0})})]})}),(0,Y.jsx)("div",{className:"col-md-4 mb-2",children:(0,Y.jsxs)("div",{className:"form-group row",children:[(0,Y.jsx)("label",{className:"col-5",htmlFor:"email-input",children:"Period"}),(0,Y.jsx)("span",{className:"col-1",children:":"}),(0,Y.jsx)("div",{className:"col-6",children:(0,Y.jsxs)("select",{id:"country-select",value:Oe,disabled:"653"==Oe,style:rt,children:[(0,Y.jsxs)("option",{value:"biweekly",disabled:"biweekly"!==Oe,children:[" ","Biweekly"]}),(0,Y.jsx)("option",{value:"custom",disabled:"custom"!==Oe,children:"Custom"}),(0,Y.jsx)("option",{value:"653",disabled:"653"!==Oe,children:"Monthly"}),(0,Y.jsx)("option",{value:"special1",disabled:"special1"!==Oe,children:"Special 1"}),(0,Y.jsx)("option",{value:"weekly",disabled:"weekly"!==Oe,children:"Weekly"})]})})]})}),(0,Y.jsx)("div",{className:"col-md-4 mb-2",children:(0,Y.jsxs)("div",{className:"form-group row",children:[(0,Y.jsxs)("label",{className:"col-5",htmlFor:"project_select",children:["Project",(0,Y.jsx)("span",{style:{color:"red"},children:"*"})]}),(0,Y.jsx)("span",{className:"col-1",children:":"}),(0,Y.jsx)("div",{className:"col-6",children:(0,Y.jsx)(m.NU,{id:"project_select",ArrowRenderer:Vt,options:ge,hasSelectAll:!1,isLoading:!1,shouldToggleOnHover:!1,disableSearch:!1,disabled:!1,value:Te,valueRenderer:Wt,onChange:function(e){Re(e);var n=e.map((function(e){return e.value}));Ae(n),$n&&(et(!1),Pe(n[0]))}})})]})}),(0,Y.jsx)("div",{className:"col-md-12 col-sm-12 col-xs-12 no-padding d-flex justify-content-center",children:(0,Y.jsxs)("button",{type:"button",className:"btn btn-primary",title:"Search",onClick:function(){null===Te&&0===Te.length||(0===Ee.length?(V("Please select projects !!"),window.scrollTo({top:0,behavior:"smooth"}),setTimeout((function(){V()}),3e3)):Yt())},children:[(0,Y.jsx)(d.U41,{})," Search"]})})]})})]}),K&&(0,Y.jsx)(C.Z,{handleAbort:function(){W.current.abort(),G(!1)}}),Q&&(0,Y.jsxs)(Y.Fragment,{children:[(0,Y.jsx)("div",{className:"materialReactExpandableTable darkHeader toHead timesheetTable",children:(0,Y.jsx)(_.ZP,{enableExpanding:!0,enablePagination:!1,enableBottomToolbar:!1,enableColumnFilterModes:!1,enableDensityToggle:!1,enableColumnActions:!1,enableFilters:!1,enableSorting:!1,enableFullScreenToggle:!1,enableHiding:!1,filterFromLeafRows:!0,initialState:{expanded:!1,density:"compact",columnVisibility:(0,s.Z)({},An),enablePinning:!0},state:{columnVisibility:(0,s.Z)({},An)},localization:{noRecordsToDisplay:(0,Y.jsx)("span",{style:{fontWeight:"bold"},children:"No records found"})},columns:We,data:an,muiTableContainerProps:{sx:{maxHeight:0===an.length?"30vh":"50vh",width:"auto",maxWidth:"fit-content",marginBottom:"10px"}},muiTableBodyCellProps:function(e){var n,t=e.row;return{sx:(n={backgroundColor:"Billable Tasks"===t.original.row_type||"Non Billable Tasks"===t.original.row_type?"rgba(52, 210, 235, 0.1)":"white",borderRight:"2px solid #e0e0e0",fontSize:"13px",borderTop:"1px solid #ccc"},(0,i.Z)(n,"borderRight","2px solid #e0e0e0"),(0,i.Z)(n,"padding","2px 8px"),(0,i.Z)(n,"verticalAlign","middle"),(0,i.Z)(n,"textAlign","center"),(0,i.Z)(n,"fontWeight",550),n)}},muiTableHeadProps:{sx:{"&":{position:"sticky",top:"0",zIndex:"5"},"& th":{borderTop:"1px solid #ccc",borderRight:"2px solid #e0e0e0",background:"#f4f4f4 ",fontSize:"13px",padding:"2px 8px",verticalAlign:"middle",textAlign:"center"}}},renderTopToolbarCustomActions:function(e){var n;e.table;return(0,Y.jsx)("div",{style:{display:"flex",justifyContent:"space-between"},children:(0,Y.jsxs)(w.Z,{sx:{display:"flex",alignItems:"center",gap:"0.1rem",p:"0.1rem",flexWrap:"wrap"},children:[(0,Y.jsx)(y.Z,{onClick:function(){!function(){var e=null===Q||void 0===Q?void 0:Q.tsDtls.startDate,n=h()(e).subtract(1,"months").format("YYYY-MM-DD"),t=h()(n).endOf("month").format("YYYY-MM-DD");It(le,n,t)}()},children:(0,Y.jsx)(k._u0,{})}),(0,Y.jsx)("b",{style:{margin:0},children:h()(null===Q||void 0===Q||null===(n=Q.tsDtls)||void 0===n?void 0:n.startDate).format("MMM")}),(0,Y.jsx)(y.Z,{onClick:function(){!function(){var e=null===Q||void 0===Q?void 0:Q.tsDtls.startDate,n=h()(e).add(1,"months").format("YYYY-MM-DD"),t=h()(n).endOf("month").format("YYYY-MM-DD");It(le,n,t)}()},children:(0,Y.jsx)(k.bBv,{})})]})})},renderToolbarInternalActions:function(e){e.table;return(0,Y.jsx)("div",{style:{display:"flex",justifyContent:"space-between"},children:(0,Y.jsx)(w.Z,{sx:{display:"flex",alignItems:"center",gap:"0.1rem",p:"0.1rem",flexWrap:"wrap"},children:(0,Y.jsx)(R.WlY,{size:"1.5em",title:"Export to Excel",style:{color:"green"},cursor:"pointer",onClick:Bt})})})}})}),(1e3===Zt||250===Zt)&&(0,Y.jsxs)("div",{className:"col-md-12 col-sm-12 col-xs-12 no-padding d-flex justify-content-center",style:{paddingTop:"10px"},children:[(0,Y.jsxs)("button",{type:"button",className:"btn btn-primary mr-2",title:"save",onClick:Pt,children:[(0,Y.jsx)(d.TvB,{})," Save"]}),(0,Y.jsxs)("button",{type:"button",className:"btn btn-secondary",title:"cancel",onClick:function(){var e=null===Q||void 0===Q?void 0:Q.tsDtls.startDate,n=h()(e).endOf("month").format("YYYY-MM-DD");It(le,e,n)},children:[(0,Y.jsx)(N.sQZ,{size:"10px"})," Cancel"]})]}),(0,Y.jsx)("div",{children:(0,Y.jsx)(Z.ZP,{className:"approvalBtns",open:v,anchorEl:un,onClose:function(){return j(!1)},anchorOrigin:{vertical:"top",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"left"},children:(0,Y.jsxs)("div",{children:[(0,Y.jsx)(S.Z,{variant:"contained",color:"success",size:"small",style:{fontSize:"10px"},onClick:function(){!function(){Mt((0,a.Z)(an),wn,4),sn((0,a.Z)(an));var e=Bn.filter((function(e){return!vn.includes(e)}));zn(e),Mn((function(e){var n=new Set(e),t=vn.filter((function(e){return!n.has(e)}));return[].concat((0,a.Z)(e),(0,a.Z)(t))}))}(),j(!1)},children:"Approve \u2714"}),(0,Y.jsx)("br",{}),(0,Y.jsx)(S.Z,{variant:"contained",color:"error",size:"small",style:{fontSize:"10px",width:"82px"},onClick:function(){!function(){Mt((0,a.Z)(an),wn,2),sn((0,a.Z)(an));var e=Pn.filter((function(e){return!vn.includes(e)}));Mn(e),zn((function(e){var n=new Set(e),t=vn.filter((function(e){return!n.has(e)}));return[].concat((0,a.Z)(e),(0,a.Z)(t))}))}(),j(!1)},children:"Reject \u2716"})]})})})]})]})}}}]);
//# sourceMappingURL=367.abbde8ab.chunk.js.map